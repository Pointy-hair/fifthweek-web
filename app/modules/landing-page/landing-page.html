<div ng-if="model.isLoaded">
  <form novalidate
        name="form"
        role="form">

    <fw-azure-image-loader output-url="model.profileImageUrl" thumbnail="header" file-id="{{model.profileImage.fileId}}" container-name="{{model.profileImage.containerName}}"></fw-azure-image-loader>
    <fw-azure-image-loader output-url="model.headerImageUrl" thumbnail="header" file-id="{{model.blog.headerImage.fileId}}" container-name="{{model.blog.headerImage.containerName}}"></fw-azure-image-loader>

    <div class="header-image" ng-style="{'background-image':'url(' + (model.blog.headerImage.fileId ? model.headerImageUrl : model.defaultHeaderImageUrl) + ')'}" id="header-image">
      <div class="header-image-control-overlay">
        <h1 class="fifthweek-logo-sm">
          <a ui-sref="creator">fw</a>
        </h1>
        <a ng-if="model.isOwner" id="edit-page-link" class="btn btn-transparent btn-transparent-emphasized" ui-sref="creator.landingPage.edit">
          edit page
        </a>
      </div>
    </div>

    <div class="main-content">
      <div class="left-margin-offset">
        <div class="row header">
          <div class="col-s-4">
            <div class="creator">
              <fw-image id="profile-image" src="{{model.profileImage.fileId ? model.profileImageUrl : model.defaultProfileImageUrl}}"></fw-image>
              <div ng-if="model.isSubscribed" class="subscribed">
                <div class="subscribe-button-wrapper">
                  <button id="subscribed-button"
                          class="btn btn-block"
                          type="submit"
                          data-event-title="Unsubscribed"
                          data-event-category="{{model.tracking.category}}"
                          data-loading-text="Unsubscribing..."
                          can-submit="true"
                          fw-form-submit="unsubscribe()"
                          error-message="model.errorMessage">Subscribed</button>
                </div>
                <p class="button-footer">1 Subscriber</p>
              </div>
              <div ng-if="!model.isSubscribed" class="subscribe">
                <div class="subscribe-button-wrapper">
                  <button id="subscribe-button"
                          class="btn btn-block"
                          type="submit"
                          data-event-title="{{model.tracking.title}}"
                          data-event-category="{{model.tracking.category}}"
                          data-loading-text="Subscribing..."
                          can-submit="true"
                          fw-form-submit="subscribe()"
                          error-message="model.errorMessage">
                            Subscribe
                            <span ng-if="!model.hasFreeAccess">&#36;{{model.totalPrice}}/week</span>
                            <span ng-if="model.hasFreeAccess"><i class="fa fa-street-view"></i> FREE</span></button>
                </div>
                <p class="button-footer">No commitments. Cancel anytime.</p>
              </div>
            </div>
          </div>
          <div class="col-s-8">
            <div class="header-text">
              <h2 id="blog-name">{{model.blog.name}}</h2>
              <h3 id="blog-tagline">{{model.blog.tagline}}</h3>
              <h4 id="blog-introduction">{{model.blog.introduction}}</h4>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-8 col-lg-offset-4">
            <div class="posts landing-page" ng-if="!model.isSubscribed">
              <fw-error-message value="model.errorMessage"></fw-error-message>
              <h5><span>What You'll Get</span></h5>
              <div class="post non-image-post channels">
                <div class="text">
                  <div class="content">
                    <div id="channel-{{$index}}" class="row channel" ng-repeat="channel in model.channels" ng-class="{first:$first, last:$last}">
                      <div class="col-xs-7">
                        <h6 class="channel-name">{{channel.name}}</h6>
                      </div>
                      <div class="col-xs-5 channel-price-column">
                      <span class="channel-price" id="channel-price-{{$index}}" ng-click="channel.checked = !channel.checked || channel.isDefault"
                            ng-class="{'unchecked':!channel.checked, 'checked':channel.checked, 'non-default':!channel.isDefault, 'default':channel.isDefault, 'guest-list-price':model.hasFreeAccess}">
                        &#36;{{channel.price}}/week
                      </span>
                      </div>
                      <div class="col-xs-8">
                        <ul class="channel-description">
                          <li ng-repeat="descriptionLine in channel.description track by $index">{{descriptionLine}}</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <p class="subscribe-now-total" ng-if="!model.hasFreeAccess">
                    <span>Total:</span> &#36;{{model.totalPrice}}/week
                  </p>
                  <p class="subscribe-now-total" ng-if="model.hasFreeAccess">
                    <span>Guest List Price:</span> $0/week
                  </p>
                  <hr />
                  <div class="subscribe-now">
                    <p>
                      <a href
                         id="subscribe-link"
                         data-event-title="{{model.tracking.title}}"
                         data-event-category="{{model.tracking.category}}"
                         data-loading-text="Subscribing..."
                         can-submit="true"
                         fw-form-submit="subscribe()"
                         error-message="model.errorMessage">
                        Subscribe Now
                      </a>
                    </p>
                  </div>
                </div>
              </div>
              <fw-error-message value="model.errorMessage"></fw-error-message>

              <div id="more-info" ng-if="model.videoUrl || model.blog.description">
                <h5><span>More Info</span></h5>
                <div class="post non-image-post" ng-if="!model.videoUrl">
                  <div class="text">
                    <div id="full-description" class="content">
                      <fw-markdown replace="true" ng-model="model.blog.description"></fw-markdown>
                    </div>
                  </div>
                </div>
                <div class="post image-post" ng-if="model.videoUrl">
                  <div id="video" class="video">
                    <embed-video data-ng-href="{{model.videoUrl}}" controls=0></embed-video>
                    <div ng-include="'views/partials/video-radius-fix.html'"></div>
                  </div>
                  <div class="text">
                    <div id="full-description" class="content">
                      <span fw-markdown ng-model="model.blog.description" ng-if="model.blog.description"></span>
                      <span ng-if="!model.blog.description">
                        <p>More of your favourites each and every week -- for less than a coffee!</p>
                      </span>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <fw-post-list source="timeline" user-id="{{model.userId}}" ng-if="model.isSubscribed"></fw-post-list>
          </div>
        </div>
      </div>
    </div>

  </form>
</div>
